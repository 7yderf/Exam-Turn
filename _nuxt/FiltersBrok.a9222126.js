import{u as g}from"./useLoading.f821adc3.js";import{k as _,aR as p}from"./entry.d136d2c8.js";function P(){const t=x(),{transformFiltersToQueryParams:i}=t;async function e(){const r=_(null);let s=null;const a=i(),o={method:"GET",redirect:"follow",headers:{accept:"application/json"}},l=new URLSearchParams(a).toString();console.log("ðŸš€ ~ fetchProperties ~ queryString:",l);const u=`http://apieasybroker-production.up.railway.app?${decodeURIComponent(l)}`;try{const n=await fetch(u,o);if(!n.ok)throw new Error("No se pudo obtener la lista de propiedades");const c=await n.json();console.log("ðŸš€ ~ fetchProperties ~ data:",c),r.value=c.data}catch(n){s=n}return{productsList:r,error:s}}return{fetchProperties:e}}const b=p("initialValues",{state:()=>({initialValues:{property_types:[{name:"Edificio",identificador:"1"},{name:"Bodega comercial",identificador:"2"},{name:"Local comercial",identificador:"3"},{name:"Nave industrial",identificador:"4"},{name:"Rancho",identificador:"5"},{name:"Quinta",identificador:"6"},{name:"Casa en condominio",identificador:"7"},{name:"Casa con uso de suelo",identificador:"8"},{name:"Terreno comercial",identificador:"9"},{name:"Local en centro comercial",identificador:"10"},{name:"Bodega industrial",identificador:"11"},{name:"Departamento",identificador:"12"},{name:"Casa",identificador:"13"},{name:"Terreno",identificador:"14"},{name:"Oficina",identificador:"15"},{name:"Local",identificador:"16"},{name:"Otro",identificador:"17"},{name:"Terreno industrial",identificador:"18"}],operation_types:[{name:"Venta",id:"sale"},{name:"Renta",id:"rental"},{name:"Renta temporal",id:"temporary_rental"}],price:{min:0,max:1e3},construction_size:{min:0,max:1e3},lot_size:{min:0,max:1e3},min_bedrooms:1,min_bathrooms:1}}),getters:{getInitialValues:t=>i=>t.initialValues[i],getSearchIdForName:t=>(i,e,r)=>r?t.initialValues[i].find(a=>a[r]===e):t.initialValues[i].find(a=>a.name===e),getSearchNameForId:t=>(i,e,r)=>r?t.initialValues[i].find(a=>a[r]===e):t.initialValues[i].find(a=>a.id===e)},actions:{setInitialValues(t){this.initialValues=t}}}),h=b(),x=p("filters",{state:()=>({filters:{page:1,limit:20,search:{property_types:[],operation_type:null,min_price:null,max_price:null,min_bedrooms:null,min_construction_size:null,max_construction_size:null,min_lot_size:null,max_lot_size:null,min_bathrooms:null,sort_by:null}},productsList:[],linkPaginate:null,nextPaginate:null,prevPaginate:null,offset:0,total:0}),getters:{getFilters:t=>(i="")=>i?t.filters.search[i]:t.filters,getProductsList:t=>t.productsList,getInitialValues:()=>t=>h.getInitialValues(t),getSearchIdForName:()=>(t,i,e)=>h.getSearchIdForName(t,i,e),getSearchNameForId:()=>(t,i,e)=>h.getSearchNameForId(t,i,e)},actions:{setOffset(t){this.offset=t},setPaginate(t){this.filters.page=Number(t)},cleanFilters(){this.total=0,this.filters={page:1,limit:20,search:{property_types:[],operation_type:null,min_price:null,max_price:null,min_bedrooms:null,min_construction_size:null,max_construction_size:null,min_lot_size:null,max_lot_size:null,min_bathrooms:null,sort_by:null}}},cleanProductsList(){this.productsList=[]},transformFiltersToQueryParams(){const t={page:this.filters.page,limit:this.filters.limit,search:{}};Object.keys(this.filters).forEach(e=>{Object.prototype.hasOwnProperty.call(this.filters,e)&&this.filters[e]!==null&&this.filters[e]!==""&&(e.startsWith("search[")&&e.endsWith("]")?(console.log("ðŸš€ ~ Object.keys ~ key.startsWith",e.endsWith("]")),t.search[e]=this.filters[e]):(console.log("ðŸš€ ~ Object.keys ~ this.filters[key]:",this.filters[e]),t[e]=this.filters[e]))});let i=`?page=${t.page}&limit=${t.limit}`;return Object.keys(t.search).forEach(e=>{var r;Object.prototype.hasOwnProperty.call(t.search,e)&&(Array.isArray(t.search[e])&&t.search[e].length>0?t.search[e].forEach(s=>{i+=`&search[${e}][]=${s}`}):t.search[e]!==null&&t.search[e]!==""&&((r=t.search[e])==null?void 0:r.length)>0&&(i+=`&search[${e}]=${t.search[e]}`))}),i},async getProperties(t){var u,n,c,d,m;const i=g();this.productsList=[],console.log("ðŸš€ ~ getProperties ~ this.productsList:",this.productsList),console.log("ðŸš€ ~ getProperties ~ load.value:",i.value);const{page:e,limit:r,...s}=t;e&&(this.filters.page=Number(e)),r&&(this.filters.limit=Number(r)),JSON.stringify(t)!=="{}"?(console.log("ðŸš€ ~ getProperties ~ query:",t),Object.keys(s).forEach(f=>{this.filters.search[f]=s[f]})):(this.filters.search={},this.filters.page=1,this.filters.limit=20);const{fetchProperties:a}=P(),{productsList:o,error:l}=await a();console.log("ðŸš€ ~ getProperties ~  error:",l),!l&&(this.productsList=(u=o.value)==null?void 0:u.content,this.total=(n=o.value)==null?void 0:n.pagination.total,this.nextPaginate=(c=o.value)==null?void 0:c.pagination.next_page,this.prevPaginate=(m=(d=o.value)==null?void 0:d.pagination)==null?void 0:m.prev_page,setTimeout(()=>{i.value=!1,console.log("ðŸš€ ~ getProperties ~ load.value:",i.value)},100),console.log("ðŸš€ ~ getProperties ~ properties:",o.value))},splitRanges(t){let i;const e={...t};return new Promise(r=>{Object.keys(e).forEach(s=>{var a,o,l,u,n,c;s==="price"&&(this.filters.search.min_price=(a=e[s])==null?void 0:a.split(",")[0],this.filters.search.max_price=(o=e[s])==null?void 0:o.split(",")[1],delete e[s]),s==="construction_size"&&(this.filters.search.min_construction_size=(l=e[s])==null?void 0:l.split(",")[0],this.filters.search.max_construction_size=(u=e[s])==null?void 0:u.split(",")[1],delete e[s]),s==="lot_size"&&(this.filters.search.min_lot_size=(n=e[s])==null?void 0:n.split(",")[0],this.filters.search.max_lot_size=(c=e[s])==null?void 0:c.split(",")[1],delete e[s]),i=e}),r(i)})},stringToArray(t,{...i}){const e={...i};return Object.keys(t).forEach(r=>{e[r]&&(this.filters.search[e[r]]=t[r].split(","),delete t[r])}),t}}});export{x as u};
